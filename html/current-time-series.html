<!DOCTYPE html>
<html>
  <head>
    <title>Current Snapstream Time Series</title>
    <meta charset="utf-8">
    <script src="d3.v3.min.js" charset="utf-8"></script>
  </head>
  <body>
    <iframe id="graph" src="time-series.html" 
            scrolling="auto" frameborder="0" 
            marginheight="0px" marginwidth="0px"
            style="border: 0px; width: 960px; height: 500px;">
    </iframe>
    <script>
     var currentDate = new Date(); 
     getLatestDate();
     function getLatestDate() {
       var dateString = currentDate.toJSON().slice(0, 10);    
       var dataRequest = new XMLHttpRequest();
       dataRequest.addEventListener("load", function(event) {
         if (this.status === 200) {
           document.getElementById("graph").src += '?filename=' + encodeURIComponent('tmp/daily_2016_republicans/' + dateString + '.csv');
         } else {
           currentDate.setDate(currentDate.getDate() - 1);
           getLatestDate();
         }
       });
       dataRequest.open("GET",
                        "tmp/daily_2016_republicans/" + dateString + ".csv");
       dataRequest.send();
     }
    </script>
  </body>
</html>
